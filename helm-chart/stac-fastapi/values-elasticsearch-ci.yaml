# helm-chart/values-elasticsearch-ci.yaml

backend: elasticsearch

app:
  replicaCount: 1
  databaseAuth:
    existingSecret: ""
    username: ""
    password: ""

elasticsearch:
  enabled: true
  clusterName: "stac-elasticsearch-ci"
  replicas: 1
  minimumMasterNodes: 1
  singleNode: true
  
  # 1. FIX: Increase timeout to 5s. 
  # A throttled CPU cannot respond in 1s during startup.
  protocol: http
  clusterHealthCheckParams: "wait_for_status=yellow&timeout=5s"

  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      # 2. FIX: Increase CPU limit. 
      # 500m is too low for ES 8.x startup.
      cpu: "1500m"
      memory: "2Gi"
  
  esJavaOpts: "-Xmx1g -Xms1g"

  extraEnvs:
    # 3. FIX: Explicitly set single-node discovery mode
    - name: "discovery.type"
      value: "single-node"
    # Security overrides
    - name: "xpack.security.enabled"
      value: "false"
    - name: "xpack.security.transport.ssl.enabled"
      value: "false"
    - name: "xpack.security.http.ssl.enabled"
      value: "false"
    - name: "xpack.security.http.ssl.client_authentication"
      value: "none"

  esConfig:
    elasticsearch.yml: |
      cluster.name: "stac-elasticsearch-ci"
      network.host: 0.0.0.0
      action.destructive_requires_name: false

  volumeClaimTemplate:
    accessModes: ["ReadWriteOnce"]
    resources:
      requests:
        storage: 5Gi

opensearch:
  enabled: false

externalDatabase:
  enabled: false

monitoring:
  enabled: false
